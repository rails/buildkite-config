#!/usr/bin/env ruby
# frozen_string_literal: true

pipeline = ARGV.shift

if ENV.has_key?("BUILDKITE")
  ENV["BUNDLE_GEMFILE"] = ".buildkite/Gemfile"
  ENV["BUNDLE_WITHOUT"] = "test"
end

$stderr.puts "--- bundle install"
unless system("bundle", "install", out: $stderr)
  exit(1)
end

$stderr.puts "--- bundle exec buildkite-builder preview #{pipeline}"
unless system("bundle", "exec", "buildkite-builder", "preview", pipeline)
  exit(1)
end
